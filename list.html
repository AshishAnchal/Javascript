<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List</title>
    <script>
        function fetchlist() {
            const url = 'https://ashishanchal.github.io/Javascript/quizlist.json';
            fetch(url)
                .then(res => {
                    if (!res.ok) throw new Error(`${res.status} - ${res.statusText}`);
                    return res.json();
                })
                .then(data => {
                    localStorage.setItem('q', JSON.stringify(data));
                    buildSubjectTable(data);
                })
                .catch(error => {
                    console.error(error);
                });
        }

        function buildSubjectTable(list) {
            let output = "<table border='2'>\n";
            list.forEach(item => {
                output += `<tr>
                    <td>${item.subject}</td>
                    <td><button onclick="getQuizzesForSubject('${item.url}')">${item.subject} Quizzes</button></td>
                </tr>\n`;
            });
            output += "</table>";
            document.getElementById("dquiz").innerHTML = output;
        }

        function startlist() {
            const stored = localStorage.getItem("q");
            if (stored) {
                buildSubjectTable(JSON.parse(stored));
            } else {
                fetchlist();
            }
        }

        function getQuizzesForSubject(quizzesurl) {
            fetch(quizzesurl)
                .then(res => {
                    if (!res.ok) throw new Error(`${res.status} - ${res.statusText}`);
                    return res.json();
                })
                .then(data => {
                    localStorage.setItem('p', JSON.stringify(data));
                    buildQuizTable(data);
                })
                .catch(error => {
                    console.error(error);
                });
        }

        function buildQuizTable(list) {
            let output = "<table border='2'>\n";
            list.forEach(item => {
                output += `<tr>
                    <td>${item.sub}</td>
                    <td>
                        <a href="https://ashishanchal.github.io/Javascript/index.html?quiz=${encodeURIComponent(item.url)}" target="_blank">
                            <button>Start</button>
                        </a>
                    </td>
                </tr>\n`;
            });
            output += "</table>";
            document.getElementById("divquiz").innerHTML = output;
        }
    </script>
</head>

<body>
    <h1>List</h1>
    <div>
        <button onclick="startlist()">Get</button>
    </div>
    <center>
        <div id="dquiz"></div> <br>
        <div id="divquiz"></div>
    </center>
</body>

</html>
