<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List</title>
    <script>
        let q = [];
        let p = [];

        function fetchlist() {
            const url = 'https://ashishanchal.github.io/Javascript/quizlist.json';
            return fetch(url)
                .then(res => {
                    if (!res.ok) throw new Error(`${res.status} - ${res.statusText}`);
                    return res.json();
                })
                .then(data => {
                    q = data;
                    localStorage.setItem('q', JSON.stringify(q));
                    return q;
                })
                .catch(error => {
                    console.error("Error fetching main list:", error);
                });
        }

        function startlist() {
            fetchlist().then(() => {
                const stored = localStorage.getItem("q");
                if (stored) {
                    q = JSON.parse(stored);
                    let output = "<table border='2'>\n";
                    q.forEach(item => {
                        output += `<tr>
                            <td>${item.subject}</td>
                            <td><button onclick="getQuizzesForSubject('${item.url}')">
                                ${item.subject} Quizzes
                            </button></td>
                        </tr>\n`;
                    });
                    output += "</table>";
                    document.getElementById("dquiz").innerHTML = output;
                }
            });
        }

        function getQuizzesForSubject(quizzesurl) {
            fetch(quizzesurl)
                .then(res => {
                    if (!res.ok) throw new Error(`${res.status} - ${res.statusText}`);
                    return res.json();
                })
                .then(data => {
                    p = data;
                    localStorage.setItem('p', JSON.stringify(p));
                    renderSubjectQuizzes();
                })
                .catch(error => {
                    console.error("Error fetching subject quizzes:", error);
                });
        }

        function renderSubjectQuizzes() {
            const showlist = localStorage.getItem("p");
            if (showlist) {
                p = JSON.parse(showlist);
                let output = "<table border='2'>\n";
                p.forEach(item => {
                    output += `<tr>
                        <td>${item.sub}</td>
                        <td><button onclick="getQuizzesForSubject('${item.url}')">
                            ${item.sub} Quizzes
                        </button></td>
                    </tr>\n`;
                });
                output += "</table>";
                document.getElementById("divquiz").innerHTML = output;
            }
        }
    </script>
</head>

<body>
    <h1>List</h1>
    <div>
        <button onclick="startlist()">Get Main List</button>
    </div>
    <center>
        <div id="dquiz"></div><br>
        <div id="divquiz"></div>
    </center>
</body>
</html>
